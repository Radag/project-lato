{*includeblock '_blocks.latte'*}
{block content}
{control topPanel}

<div class="container main two-level-nav" id="group">
    <div class="row">
        {snippet streamSection}
        <div class="col s12 l8" id="stream" >
            {control stream}
        </div>
        {/snippet}
        <div class="col s12 l4" id="stream-cards">
            <div class="card flex-column" id="assignment-card">
                <div class="card-header">
                    <h3>Povinnosti</h3>
                </div>
                {if !empty($actualTasks)}
                <div class="card-content">
                    <ul class="custom-collection" n:if="!empty($actualTasks)">
                        {foreach $actualTasks as $task}
                        <li>
                            <a href="{plink Group:message 'id'=>$task->group->urlId, 'idMessage'=>$task->idMessage}" class="truncate">
                                <p class="remaining-time">Odevzdat
                                {if $task->timeLeft->y > 0}
                                    {$task->timeLeft->format('%y let')}
                                {elseif $task->timeLeft->m > 0}
                                    {$task->timeLeft->format('%m měsíců')}
                                {elseif $task->timeLeft->d > 0}
                                    {$task->timeLeft->format('%d dní')}
                                {elseif $task->timeLeft->h > 0}
                                    {$task->timeLeft->format('%h hodin')}
                                {elseif $task->timeLeft->i > 0}
                                    {$task->timeLeft->format('%i minut')}
                                {/if}  
                                </p>
                                <p class="secondary-par truncate">{$task->title}</p>     
                            </a>
                        </li>
                        {/foreach}
                    </ul>
                </div>
                <div class="card-footer">
                    <a href="" class="btn-flat card-bottom">
                        Zobrazit další
                    </a>
                </div>
                {else}
                <div class="card-content">
                    <p class="secondary-par">V tuto chvíli nemáte v předmětu zvěřejněny žádné povinnosti</p> 
                </div> 
                <div class="card-footer card-bottom"></div>
                {/if}     
            </div>
            <div class="card flex-column"  n:if="!$groupPermission['isTeacher'] && $lastClassificationChange">
                <div class="card-header">
                    <h3>Známky</h3>
                </div>
                <div class="card-content">
                    <p class="secondary-par">Poslední změna <strong>{$lastClassificationChange->format("j. n. H:m")}</strong></p>
                </div>
                <div class="card-footer">
                    <a href="{link :Front:Homepage:classification}" class="btn-flat card-bottom">
                        Zobrazit
                    </a>
                </div>
            </div>
            <div class="card flex-column">
                <div class="card-header">
                    <h3>Filtrovat příspěvky</h3>
                </div>
                <div class="card-content">
                    <p class="secondary-par">Zobrazit pouze následující položky</p>
                    <form class="checkbox-form-block">
                        <div class="form-row">
                            <input type="radio" value="all" class="filled-in" id="opt1" name="stream-filter" checked="checked" />
                            <label for="opt1">Všechny příspěvky</label>
                        </div>
                        <div class="form-row">
                            <input type="radio" value="notice" class="filled-in" id="opt2" name="stream-filter" />
                            <label for="opt2">Oznámení</label>
                        </div>
                        <div class="form-row">
                            <input type="radio" value="material" class="filled-in" id="opt3" name="stream-filter" />
                            <label for="opt3">Studijní materiály</label>
                        </div>
                        <div class="form-row">
                            <input type="radio" value="task" class="filled-in" id="opt4" name="stream-filter" />
                            <label for="opt4">Povinnosti</label>
                        </div>
                    </form>
                    <script>
                        $("form input[name='stream-filter']").on('change', function (event) {
                            $.nette.ajax({
                                url: {link changeFilter!},
                                method: 'POST',
                                data: {'filter' : $("form input[name='stream-filter']:checked").val()}
                            });
                        });
                    </script>
                </div>
            </div>
            
            <div class="card flex-column" n:if="$groupPermission['showDeleted']">
                <div class="card-header">
                    <h3>Výpis příspěvků</h3>
                </div>
                <div class="card-content clearfix">
                    {form streamSettingsForm id=>"streamSettingsForm"}
                    <div class="switch-row">
                        <p class="secondary-par left">Zobrazit smazané položky</p>
                        <div class="switch right">
                            <label>
                                {input showDeleted:}
                                <span class="lever"></span>
                            </label>
                        </div> 
                    </div>
                    {/form}
                    <script>
                    $(document).ready(function () {
                        $("#streamSettingsForm input[type='checkbox']").on('change', function () {
                            $("#streamSettingsForm").submit();
                        });
                    });
                    </script>
                </div>
                <div class="card-footer"></div>
            </div>

            {*
            {if $activeGroup->owner->id === $activeUser->id}
            <div class="card flex-column bottom-spacer" n:if="$groupPermission['settings']">
                <div class="card-header">
                    <h3>Sdílení</h3>
                </div>
                {snippet sharingFormWrap}

                <div class="card-content clearfix">
                    {form sharingForm id=>"sharingForm"}
                    <div class="switch-row">
                        <p class="secondary-par left">
                            {if $activeGroup->shareByLink == 1}
                            Vypnout sdílení odkazem
                            {else}
                            Zapnout sdílení odkazem
                            {/if}
                            <div class="switch right">
                                <label>
                                    {input shareByLink:}
                                    <span class="lever"></span>
                                </label>
                            </div>
                        </p>
                    </div>
                    <div class="switch-row">
                        <p class="secondary-par left">
                            {if $activeGroup->shareByCode == 1}
                            Vypnout sdílení kódem
                            {else}
                            Zapnout sdílení kódem
                            {/if}
                            <div class="switch right">
                                <label>
                                    {input shareByCode:}
                                    <span class="lever"></span>
                                </label>
                            </div>
                        </p>
                    </div>
                    {/form}
                    <p class="secondary-par left">Zápis do této skupiny mohou ostatní uživatelé provést pomocí kódu <strong>{$activeGroup->interCode}</strong>
                    {if $activeGroup->shareByLink == 1} nebo odkazem <strong>{link //:Public:Action:default, id => $activeGroup->publicCode}</strong>{/if}                    
                    </p>
                    <a class="btn-flat light-gray card-bottom modal-trigger" href="#add-user-to-group">
                        Přidat uživatele
                    </a>

                    <!-- Modal -->
                    <div id="add-user-to-group" class="modal">
                        <div class="modal-content">
                            <h3>Sdílení</h3>
                            <p>
                                <form action="{link addToGroup!}" method="post" >
                                    <div class="row form-row">
                                        <div class="input-field col s12">
                                            <input type="text" value="{link //:Public:Action:default, id => $activeGroup->publicCode}" >
                                            <label for="autocomplete-input">Odkaz ke sdílení</label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-field col s12">
                                            <input name="userName" type="text" id="userSearch" class="autocomplete">
                                            <label for="userSearch">Vyhledat uživatele</label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-field col s12">
                                            <input type="submit" value="Vložit">
                                        </div>
                                    </div>
                                </form>
                            </p> 
                        </div>
                    </div>  
                </div>
                <script>
                    $(document).ready(function () {
                        $("#sharingForm input[type='checkbox']").on('change', function () {
                            $("#sharingForm").submit();
                        });
                    });
                </script>

                {/snippet}
            </div>
            {/if}
            *}
            
        </div>
        

    </div>
    <div id="commit-task-modal" class="modal modal-small">
        {snippet commitTaskForm}
            {control commitTaskForm}
        {/snippet}
    </div>
</div>

<script>
    /*var idSession = null;
    (function () {
        if (idSession === null) {
            var link = {link checkNews!};
        } else {
            var link = {link checkNews!} + '&idSession=' + idSession;
            ;
        }

        $.getJSON(link, function (data) {
            idSession = data.idSession;
            if (data.news > 0) {
                $.nette.ajax({
                    url: {link redrawNews!},
                    method: 'GET'
                });
            }
        });
        setTimeout(arguments.callee, 5000);
    })();*/
</script>




